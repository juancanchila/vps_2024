"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5998],{5998:(y,h,a)=>{a.r(h),a.d(h,{ModoColaboradorPageModule:()=>A});var f=a(9808),u=a(4182),n=a(4881),g=a(4644),c=a(7582),m=a(7423),l=a(6090),t=a(2096),p=a(7832),C=a(4547),P=a(7556);const v=[{path:"",component:(()=>{class i{constructor(o,e,r,s,b,O){this.alertControl=o,this.diagnostic=e,this.geo=r,this.zone=s,this.auth=b,this.router=O,this.value=!1,this.character=[],this.getLocation(),this.getGpsPermision(),this.requestPermissions()}ionViewWillEnter(){console.log("Modo colaborador - ionViewWillEnter"),this.iniciarModoColaborador()}iniciarModoColaborador(){console.log("Cargando Modo Colaborador"),this.auth.consultarIdAuxiliar().subscribe(o=>{console.log(o,"Respuesta"),console.log(o[0].roles_target_id),localStorage.setItem("rolAuxiliar",o[0].roles_target_id),localStorage.setItem("idAuxiliar",o[0].uid),localStorage.setItem("tipoVehiculo",o[0].field_tipo_de_vehiculo)}),this.getGpsPermision(),this.getLocation(),this.loadEstadoDisponibilidad()}getGpsPermision(){this.diagnostic.getPermissionAuthorizationStatus(this.diagnostic.permission.ACCESS_FINE_LOCATION).then(o=>{o!==this.diagnostic.permissionStatus.GRANTED?this.diagnostic.requestRuntimePermissions([this.diagnostic.permission.ACCESS_FINE_LOCATION,this.diagnostic.permission.ACCESS_COARSE_LOCATION]).then(e=>{console.log("getCameraAuthorizacionStatus"),console.log(e)}):(console.log("we have the permission"),this.getLocation())},o=>{console.log("statusError"),console.log(o)})}requestPermissions(){return(0,c.mG)(this,void 0,void 0,function*(){const o=yield l.b.requestPermissions();console.log("Perm request result: ",o)})}getCurrentCoordinate(){m.dV.isPluginAvailable("Geolocation")?l.b.getCurrentPosition().then(o=>{this.latitude=o.coords.latitude,this.longitude=o.coords.longitude}).catch(o=>{console.error(o)}):console.log("Plugin geolocation not available")}getLocation(){var o;return(0,c.mG)(this,void 0,void 0,function*(){try{const e=l.b.checkPermissions();if(console.log("Permisos status: ",(yield e).location),"granted"!=(null===(o=yield e)||void 0===o?void 0:o.location)&&"granted"!=(yield l.b.requestPermissions()).location)return void this.geo.openSetting();const s=l.b.getCurrentPosition({maximumAge:3e3,timeout:1e4,enableHighAccuracy:!0});console.log("Position obtenida",s),this.auth.latitud=(yield s).coords.latitude,this.auth.longitud=(yield s).coords.longitude,console.log((yield s).coords.latitude,"poss lat",(yield s).coords.longitude,"poss long")}catch(e){throw console.log(e),e}})}watchPosition(){try{this.watchId=l.b.watchPosition({},(o,e)=>{this.zone.run(()=>{this.watchCoordinate={latitude:o.coords.latitude,longitude:o.coords.longitude}})})}catch(o){console.error(o)}}clearWatch(){null!=this.watchId&&l.b.clearWatch({id:this.watchId})}ngOnDestroy(){console.log("Modo colaborador - OnDestroy"),this.clearWatch()}iraHistorialPedidos(){this.router.navigate(["/historial-solicitudes"])}irAPedidosEnCurso(){this.router.navigate(["/index-auxiliares"])}checkcButon(o){return(0,c.mG)(this,void 0,void 0,function*(){console.log(this.value,"Estado"),this.evaluado?this.evaluado=!1:this.validarAsignaciones(this.value)})}doRefresh(o){this.iniciarModoColaborador(),console.log("Begin async operation"),setTimeout(()=>{console.log("Async operation has ended"),o.target.complete()},2e3)}validarAsignaciones(o){this.value=o,this.auth.getContenidoAsignado().subscribe(e=>(0,c.mG)(this,void 0,void 0,function*(){console.log(e,"respuesta contenido asignado"),0===e.length&&(this.estadoAuxiliar=this.value?"Auxiliar Disponible":"Auxiliar Ocupado",console.log("Puede Cambiar estado"),this.auth.actualizarDisponibleAuxiliar(!!this.value),console.log(localStorage.getItem("nodeDisponibilidad")),this.auth.actualizarPosicion(o)),e.length>0&&(console.log("No Puede Cambiar estado"),this.evaluado=!0,this.value=!1,this.estadoAuxiliar="Auxiliar Ocupado",yield(yield this.alertControl.create({header:"Notificaci\xf3n Vapaesa",message:"Tienes pedido en curso pendiente, Por eso estaras en Modo Ocupado!",buttons:[{text:"aceptar"}]})).present())}))}loadEstadoDisponibilidad(){return(0,c.mG)(this,void 0,void 0,function*(){try{const o=yield this.auth.getDisponibilidadPropia().toPromise();if(console.log(o,"res"),o.length>0){localStorage.setItem("nodeDisponibilidad",o[0].nid);let e=o[0].field_estado;this.nid=o[0].nid,this.posicionActivaAuxiliar=o[0].nid,"Off"===e?(this.estadoAuxiliar="Auxiliar Ocupado",this.value=!1):(this.estadoAuxiliar="Auxiliar Disponible",this.value=!0)}else console.log("Creando"),this.auth.EnviarPosicionAuxiliar(),this.estadoAuxiliar="Auxiliar Disponible",this.value=!0}catch(o){console.error("Error al obtener la disponibilidad:",o)}})}}return i.\u0275fac=function(o){return new(o||i)(t.Y36(n.Br),t.Y36(p.R),t.Y36(C.P),t.Y36(t.R0b),t.Y36(P.e),t.Y36(g.F0))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-modo-colaborador"]],decls:17,vars:2,consts:[["slot","start"],[1,"main-menu"],["src","../../assets/LOGOPEQUE\xd1O.png","width","40%","alt","",1,"imgtoolbar"],["slot","fixed",3,"ionRefresh"],["id","camino","replaceUrl","true","type","submit","color","succes","expand","block",3,"click"],["id","completado","replaceUrl","true","type","submit","color","succes","expand","block",3,"click"],[1,"labelColor"],["id","check","slot","start","name","kiwi","color","success",3,"ngModel","ngModelChange","ionChange"]],template:function(o,e){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button",1),t.qZA(),t._UZ(4,"img",2),t.qZA()(),t.TgZ(5,"ion-content")(6,"ion-refresher",3),t.NdJ("ionRefresh",function(s){return e.doRefresh(s)}),t._UZ(7,"ion-refresher-content"),t.qZA(),t.TgZ(8,"ion-list")(9,"ion-button",4),t.NdJ("click",function(){return e.irAPedidosEnCurso()}),t._uU(10,"PEDIDO EN CURSO"),t.qZA(),t.TgZ(11,"ion-button",5),t.NdJ("click",function(){return e.iraHistorialPedidos()}),t._uU(12,"HISTORIAL DE PEDIDOS"),t.qZA()(),t.TgZ(13,"ion-item")(14,"ion-label",6),t._uU(15),t.qZA(),t.TgZ(16,"ion-toggle",7),t.NdJ("ngModelChange",function(s){return e.value=s})("ionChange",function(s){return e.checkcButon(s)}),t.qZA()()()),2&o&&(t.xp6(15),t.Oqu(e.estadoAuxiliar),t.xp6(1),t.Q6J("ngModel",e.value))},directives:[n.Gu,n.sr,n.Sm,n.fG,n.W2,n.nJ,n.Wo,n.q_,n.YG,n.Ie,n.Q$,n.ho,n.w,u.JJ,u.On],styles:["ion-title[_ngcontent-%COMP%]{text-align:center;text-transform:uppercase}ion-toolbar[_ngcontent-%COMP%]{color:#fff;--ion-background-color: #262262}.imgtoolbar[_ngcontent-%COMP%]{display:block;margin-left:20%;align-items:center;width:50%;height:50%;text-align:center}.botonGp[_ngcontent-%COMP%], .botonGp[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#d7d8da;color:#fff;border-radius:10px}ion-button[_ngcontent-%COMP%]{display:block;background-color:#fff;color:#000}.labelColor[_ngcontent-%COMP%]{color:#fff}.toggleUno[_ngcontent-%COMP%]{height:20px;width:31%;--background: rgb(0, 255, 21);--background-checked: rgb(0, 255, 21);--handle-width: 25px;--handle-height: 30px;--handle-background: rgb(0, 255, 21);--handle-background-checked: #000}#noDisponible[_ngcontent-%COMP%], .togleDos[_ngcontent-%COMP%]{height:20px;width:31%;--background: #7c1313;--background-checked: red;--handle-width: 25px;--handle-height: 30px;--handle-background: red;--handle-background-checked: #000}body[_ngcontent-%COMP%]{--ion-color-primarycontrast: #ffffff}ion-tab-bar[_ngcontent-%COMP%]{--ion-background-color: #262262}ion-icon[_ngcontent-%COMP%], ion-label[_ngcontent-%COMP%]{display:flex;color:#ff0}h1[_ngcontent-%COMP%]{margin:auto}ion-row[_ngcontent-%COMP%]{--ion-color-primarycontrast: #ffffff;height:auto;width:auto}ion-content[_ngcontent-%COMP%]{--ion-background-color: #262262}"]}),i})()}];let M=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[g.Bz.forChild(v)],g.Bz]}),i})(),A=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[f.ez,u.u5,n.Pc,M]]}),i})()}}]);